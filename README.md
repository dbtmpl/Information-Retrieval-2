# Information-Retrieval-2

Current project structure:
```
IR2/
 - apex/ (not used yet)
 - OpenNIR/
 - src/ (this repo)
   - data/
     - qulac/ (here all OpenNIR/anserini stuff will be saved)
     - documents/webclue_docs/
       - {1-200}.json Note: All docs needed now!
```

All documents are needed now such that the code runs smoothly. Indexing all docs took on my machine ~20 minutes. 

Further, the `split_data()` function in `utils/data_utils` creates `train.qrels.txt`, `valid.qrels.txt`, `test.qrels.txt` (Files are also in the git).

Everything else will be generated by running OpenNIR.

We have now our own `ranker`, `trainer` and `vocab` classes. Check out `src`. 

Because of some hard coded paths we need to run our stuff from the OpenNIR folder. Like this:
``` 
python ../src/start.py ../src/config/ranker/std_neural_rankers/conv_knrm_qqa ../src/config/qulac
```
By using the OpenNIR`util.Registry` we can put our code (new Dataset, Trainer, Ranker, etc.) in our `src` for examples.

To use OpenNIR as a library:
```
git clone https://github.com/Georgetown-IR-Lab/OpenNIR.git
cd OpenNIR
pip install -e .
```
### Surfsara

Move the run.sh file into the OpenNIR directory using

```
mv run.sh ../OpenNIR
```

the .bashrc file might need to be updated to support java 11, if the script does not run the add the following
```
export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
```

To start the job run
```
sbatch run.sh
```

### Adding and using configs
First add new config to config file e.g. `config/qulac/_dir`. General pattern:
```
<class_key>.<config_name>=<value>

# Possible <class_key> are: 'vocab', 'train_ds', 'ranker', 'trainer', 'valid_ds', 'valid_pred', 'test_ds', 'test_pred', 'pipeline'
# See keys in context dict in start.py
```
Example add embedding aggregation config:
```
vocab=wordvec_hash_qqa
vocab.aggregation=mean
```
Now the config name needs needs a default. So it needs to be set in the `default_config()` function. In the vocab:
```
# The vocab you use e.g. WordvecHashVocabQQA ...
@staticmethod
def default_config():
    result = WordvecVocab.default_config().copy()
    result.update({
        'hashspace': 1000,
        'init_stddev': 0.5,
        'log_miss': False,
        'aggregation': 'mean' <== Add new
    })
    return result
``` 
Now config will be part of the config dict in the `__init__()` of the respective class and can be used:
```
# in WordvecHashVocabQQA class...

def __init__(self, config, logger, random):
    super().__init__(config, logger, random)
    self.enc_aggregation = config['aggregation']

    # Do something with new config
```
If config does not appear most likely the naming of the `<class_key>` (in this case `vocab`) is wrong.